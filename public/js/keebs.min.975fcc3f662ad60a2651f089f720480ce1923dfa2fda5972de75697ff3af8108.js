window.addEventListener("DOMContentLoaded",()=>{"use strict";const e={"ISO-A":["iso","intlBackslash","am"],ISO:["iso","intlBackslash"],ANSI:["ansi"],TMx:["ol60","ergo"],"4×6":["ol50","ergo"],"3×6":["ol40","ergo"]};for(const n of document.querySelectorAll(".keyboard")){const d=n.querySelector("dialog"),t=n.querySelector("x-keyboard"),s=n.querySelector("object"),o=n.querySelector("input[placeholder]"),i=n.querySelector("form"),a=n.querySelector("select")||document.getElementById("geometry"),r=n.querySelector("button"),u=()=>a?a.value:i.elements.geometry.value,h=()=>e[u()][0].toLowerCase(),c=()=>{if(t.geometry=h(),s){const t=e[u()].concat(s.className).join(" ");s.contentDocument.documentElement.setAttribute("class",t)}};if(a?.addEventListener("change",c),s?.addEventListener("load",c),i?.addEventListener("change",()=>{s.className=i.elements.layers.value,c()}),i&&(i.elements.layers.value=s.className,i.querySelector(".layers").hidden=!s.className),fetch(t.getAttribute("src")).then(e=>e.json()).then(e=>{t.setKeyboardLayout(e.keymap,e.deadkeys,h()),r&&(r.disabled=!1)}),!t.layout){console.warn("web components are not supported");return}if(!o)return;r?.addEventListener("click",()=>{d?.showModal(),o.value="",o.focus()}),o.addEventListener("blur",()=>{t.clearStyle(),d?.close()});const l={};o.addEventListener("keydown",e=>{l[e.code]=!0;const n=t.keyDown(e);if(e.code==="Enter")e.target.value="";else if(n)e.target.value+=n;else return!0;return!1}),o.addEventListener("keyup",e=>{l[e.code]?(t.keyUp(e),delete l[e.code]):(e.target.value+=t.keyDown(e),setTimeout(()=>t.keyUp(e),100))}),o.addEventListener("input",e=>{(e.inputType==="insertCompositionText"||e.inputType==="insertText")&&(e.target.value=e.target.value.slice(0,-e.data.length))})}})